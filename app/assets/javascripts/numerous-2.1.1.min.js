// Numerous.js
// Unobtrusive Javascript helper for dynamically creating fields_for objects for Rails.
// Version 2.1.1
//
// Author: Karl Bryan Paragua
// Source: https://github.com/kbparagua/numerous.js
$(document).ready(function(a){Numerous={};Numerous.init=function(a){var b=$(".numerous");Numerous.addFormHash={};Numerous.options=a||{};for(var c=0,d=b.length;c<d;c++){var e=$(b[c]),f=e.attr("id"),g=f.replace(/fields-for-/,""),h="add-to-"+g,i="#"+g,j=Numerous.options[g];e.removeClass("numerous").attr("id","");var k=$("<div></div>").append(e);Numerous.addFormHash[h]={form:k.html(),"fields-for":f,"update-div":i,list:g};e.remove();Numerous.clickHandlerForAdd(h);Numerous.createHandlersForRemove(g);if(j){var l=j["initial"],m=$("#"+h),n=l;if(typeof l==="function"){n=l()}for(var c=0;c<n;c++){m.trigger("click")}var o=j["after-initialize"];if(o){o()}}}};Numerous.clickHandlerForAdd=function(a){var b="#"+a;$(b).click(function(a){a.preventDefault();var b=Numerous.addFormHash[this.id],c=(new Date).getTime(),d=b["form"].replace(/replace_this/g,c);d=$(d);d.addClass(b["fields-for"]);var e=d.find("[name*="+c+"]:first").attr("name"),f=new RegExp("^(\\[|\\]|\\w|\\s|-)+\\["+c+"\\]");namePrefix=e.match(f)[0],removeInputName=namePrefix+"[_destroy]",removeInput=$('<input type="hidden" value="0" class="numerous-remove-field" name="'+removeInputName+'"/>');d.append(removeInput);$(b["update-div"]).append(d);var g=Numerous.options[b["list"]];if(g){var h=g["add"];if(h){h(d)}}})};Numerous.createHandlersForRemove=function(a){var b=".fields-for-"+a+" .numerous-remove";$("body").off("click",b);$("body").on("click",b,function(b){b.preventDefault();var c=$(this),d=c.parent(),e=c.siblings(".numerous-remove-field:first");if(e.length==0){var f=d.find('input[name*="[id]"]:first');if(f.length==0){d.remove()}else{var g=f.attr("name").replace("[id]",""),h=g+"[_destroy]";e=$('<input type="hidden" value="0"'+'class="numerous-remove-field" name="'+h+'"/>');d.append(e)}}e.attr("value","1");d.removeClass("fields-for-"+a);d.hide();var i=Numerous.options[a];if(i){var j=i["remove"];if(j){j(d)}}})};Numerous.count=function(a){return $(".fields-for-"+a).length};Numerous.get=function(a){return $(".fields-for-"+a)};Numerous.removeAll=function(a){Numerous.get(a).find(".numerous-remove").trigger("click")}})
